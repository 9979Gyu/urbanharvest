<!DOCTYPE html>
<html>
    <head>
        <title>Urban Harvest-Booking</title>
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="/js/script.js"></script>

        <script>
            $(document).ready(function () {
                var savedName = localStorage.getItem("gardenName");
                var savedPlot = localStorage.getItem("plotNo");
                var savedAddress = localStorage.getItem("gardenAddress");
                var savedBookDT = localStorage.getItem("bookDT");
                var savedBookExpired = localStorage.getItem("bookExpired");
                var savedYear = localStorage.getItem("bookYear");
                $("input[name='bookYear']").prop('disabled', false);

                // Check if there is saved data
                if (savedName && savedPlot && savedAddress && savedYear && savedBookDT) {
                    // Display the saved data in your HTML elements
                    var option = $('<option>').val(savedName).text(savedName);
                    $("#gardenName").append(option).val(savedName);

                    $("input[name='plotNo']").val(savedPlot);
                    $("textarea[name='gardenAddress']").val(savedAddress);
                    $("input[name='bookDT']").val(savedBookDT);
                    $("input[name='bookYear'][value='" + savedYear + "']").prop("checked", true);
                    $("input[name='bookExpired']").val(savedBookExpired);
                    $("span:eq(0)").html(localStorage.getItem("bookApproval"));
                    $("span:eq(1)").html(localStorage.getItem("paymentStatus"));
                    $("span:eq(2)").html(parseInt(savedYear) * 50);

                    if(localStorage.getItem("balance") && localStorage.getItem("payAmount") && localStorage.getItem("payDT")){
                        $("input[name='balance']").val(localStorage.getItem("balance"));
                        $("input[name='payAmount']").val(localStorage.getItem("payAmount"));
                        $("input[name='payAmount']").prop('disabled', true);
                        $("input[name='payDT']").val(localStorage.getItem("payDT"));
                    }

                    buttonControl();
                } 
                else {
                    $("article:eq(1)").hide();
                    $(".message").html("No booking record exists. You can book <a href='add.html'>here</a>.").css("color", "Red");
                }

                if($("span:eq(0)").html().toUpperCase() === "DECLINED"){
                    $(".paySection").hide();
                }

                $("button[name='pay']").click(function () {
                    var amount = parseFloat($("input[name='payAmount']").val());

                    if (isNaN(amount)) {
                        $(".message").html("Please enter numbers only");
                        scrollToMessage();
                        $("input[name='payAmount']").focus();
                    } 
                    else if (amount >= 50 * savedYear) {
                        var balance = amount - 50 * savedYear;
                        var payDT = getDate(false, 0);
                        alert("Thank you.");
                        $("input[name='balance']").val(balance);
                        $("input[name='payDT']").val(payDT);
                        $("span:eq(1)").html("Paid");
                        $(".message").hide();

                        localStorage.setItem("balance", balance);
                        localStorage.setItem("payDT", payDT);
                        localStorage.setItem("paymentStatus", "Paid");
                        localStorage.setItem("payAmount", amount);

                        buttonControl();
                    } 
                    else {
                        $(".message").html("Sorry, the amount is not enough. Try again");
                        scrollToMessage();
                        $("input[name='payAmount']").focus();
                    }
                });

                function buttonControl(){

                    $("button[name='extend']").hide();
                    $("button[name='pay']").hide();
                    $("button[name='edit']").hide();
                    $(".amount").hide();

                    if($("span:eq(0)").html().toUpperCase() == "PENDING"){
                        $("button[name='edit']").show();
                    }
                    else if($("span:eq(0)").html().toUpperCase() == "APPROVED" && 
                        $("span:eq(1)").html().toUpperCase() == "PENDING"){
                        $("button[name='pay']").show();
                        $(".amount").show();
                        $("input[name='bookYear']").prop('disabled', true);
                    }
                    else if($("span:eq(1)").html().toUpperCase() == "PAID"){
                        $("button[name='extend']").show();
                        $(".amount").show();
                        $("input[name='bookYear']").prop('disabled', true);
                    }
                    
                }

                $("button[name='extend']").click(function(){
                    window.location.href = "extend.html";
                });

                $("button[name='delete']").click(function(){
                    var result = window.confirm("Are you sure to cancel plot booking?");
                    if(result){
                        localStorage.clear();
                        window.location.reload();
                    }
                });

                $("button[name='edit']").click(function(){
                    var result = window.confirm("Are you sure to save changes to the plot booking?");
                    if(result){
                        var newBookYear = $("input[name='bookYear']:checked").val();
                        localStorage.setItem("bookDT", getDate(false, newBookYear));
                        localStorage.setItem("bookExpired", getDate(true, newBookYear));
                        localStorage.setItem("bookYear", newBookYear);
                        $("span:eq(2)").html(parseInt(savedYear) * 50);
                        $("input[name='bookDT']").val(localStorage.getItem("bookDT"));
                        $("input[name='bookExpired']").val(localStorage.getItem("bookExpired"));
                    }
                });

                if(localStorage.getItem("extendYear")){
                    $("button[name='extend']").hide();
                }

            });

        </script>
    </head>
    <body>
        <header>
            <nav>
                <ul>
                    <li><a href="/index.html">Home</a></li>
                    <li>
                        <a href="#">Booking</a>
                        <ul class="innerlist">
                            <li><a href="/booking/index.html"><i class="fas fa-seedling"></i>Current Booking</a></li>
                            <li><a href="/booking/history.html"><i class="fas fa-table"></i>History Booking</a></li>
                            <li><a href="/booking/viewExtend.html"><i class="fas fa-redo"></i>Extend Booking</a></li>
                            <li></li>
                        </ul>
                    </li>
                    <!-- <li><a href="#"><img src="/assets/img/user.png"/></a></li> -->
                    <li><a href="#"><i class="fas fa-user"></i></a></li>
                </ul>
            </nav>
        </header>
        <section id="dashboard">
            <article class="dash-title">
                <p>Urban Harvest</p>
            </article>
            <article id="vision">
                <h2>Vision</h2>
                <p>To cultivate vibrant and sustainable urban communities through UrbanHarvest, fostering a shared commitment to green living, community engagement, and the creation of thriving, accessible green spaces for all.</p>
            </article>
            <article id="mission">
                <h2>Mission</h2>
                <p>At UrbanHarvest, our mission is to empower individuals and communities to actively participate in the development of green urban landscapes. We provide a user-friendly, web-based platform that enables residents to effortlessly select, reserve, and contribute to community garden plots. Through seamless online transactions, we aim to enhance accessibility to safe, inclusive green spaces, thereby promoting environmental sustainability, community well-being, and the realization of Sustainable Development Goal 11.</p>
            </article>
            <article id="collaboration">
                <h2>Collaboration</h2>
                <div>
                    <img src="/assets/img/utem.png"/>
                </div>
            </article>
            <article id="about1">
                <h2>About Us</h2>
                <div class="flex-container">
                    <img class="round" src="/assets/img/member1.jpg"/>
                    <div class="center">
                        <p>Name: Gui Yu Qin</p>
                        <p>Email: B032220008@student.utem.edu.my</p>
                        <p>Contact: 0129231224</p>
                    </div>
                </div>
                <div class="flex-container">
                    <img class="round" src="/assets/img/member2.jpg"/>
                    <div class="center">
                        <p>Name: Nazarifah Nazurah Binti Ronzi</p>
                        <p>Email: B032120057@student.utem.edu.my</p>
                        <p>Contact: 0199014704</p>
                    </div>
                </div>
            </article>
            <article id="about2">
                <div class="flex-container">
                    <img class="round" src="/assets/img/user.png"/>
                    <div>
                        <p>Name: Siti Zulaika</p>
                        <p>Email: B0321232432@student.utem.edu.my</p>
                        <p>Contact: 01123453443</p>
                    </div>
                    
                </div>
                <div class="flex-container">
                    <img class="round" src="/assets/img/user.png"/>
                    <div>
                        <p>Name: Siti Erika</p>
                        <p>Email: B032123222@student.utem.edu.my</p>
                        <p>Contact: 0199231204</p>
                    </div>
                </div>
            </article>
        </section>
        
        <footer>
            Copyright &copy; group C-A
        </footer>
    </body>
</html>